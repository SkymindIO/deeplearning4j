---
title: 将Keras模型导入Deeplearning4j 
layout: cn-default
---
<p><h1>用于生产环境的Keras（Python + JVM）</h1></p>
<p><a href="https://keras.io" target="_blank">Keras</a>是目前使用最广泛的为Python编写的开源深度学习工具之一。Keras有一套受Torch启发的API，在Theano和TensorFlow的基础上再提供一个抽象层，让此二者更易于使用。Keras允许用户导入来自Theano、TensorFlow、Caffe和Torch等最先进的深度学习框架的模型。而同样的模型可以从Keras导入到Deeplearning4j中。 </p>
<p>Deeplearning4j有一项采用Keras的<a href="https://github.com/crockpotveggies/dl4j-examples/tree/keras-examples/dl4j-keras-examples" target="_blank">Python API</a>，让开发者能通过Keras导入其他学习框架的模型（见下文）；也就是说，使用Python的团队可以将工作成果导入到JVM中进行大规模推广，而无需浪费精力重写模型。</p><br>

<p><h2>用Docker运行DL4J－Keras示例</h2></p>
<ul>
	<il>安装<a href="https://www.docker.com/products/docker-toolbox" target="_blank">Docker Toolbox</a></il>
	<ul>
		<il>在安装过程中，您需要在Docker Quickstart Terminal和Kitematic之间选择。请选择Kitematic，它会让您在Docker Hub上注册。 </il>
	</ul>
	<il>请用下面的代码git克隆以下dl4j-examples分支：<br />
	<pre><code class="language-java">
	git clone https://github.com/crockpotveggies/dl4j-examples --branch keras-examples --single-branch
	</code></pre>
	</il>
</ul><br />
<p>Kitematic的主界面如下图所示：</p>
<img class="img-responsive center-block" src="../img/kitematic-dashboard.png" alt="deeplearning4j"><br>
<p>点击右上方的“My Images”您的镜像之一应当是<code>keras-dl4j</code>。</p>
<img class="img-responsive center-block" src="../img/kitematic-my-images.png" alt="deeplearning4j"><br>
<p>点击“Create”。</p>
<img class="img-responsive center-block" src="../img/kitematic-provisioning.jpg" alt="deeplearning4j"><br>
<p>点击右上方的图标，系统将会打开一个浏览器窗口，用localhost访问Jupyter。您将看到要求Jupyter令牌的页面，令牌需要从Kitematic的bash控制台中复制粘贴。</p>
<img class="img-responsive center-block" src="../img/jupyter-token.png" alt="deeplearning4j"><br>
<p>将令牌复制输入后，应会看到如下画面。</p>
<img class="img-responsive center-block" src="../img/jupyter-home.png" alt="deeplearning4j"><br>
<p>点击右上方的“New”并选择在笔记本下选择Python 2，这会在新标签页中打开一个新的笔记本。 </p>
<p>点击文件列表底端的路透社MLP示例。复制Keras代码并将其粘贴至新建的Python 2笔记本中。在该笔记本中，点击工具栏上有一个向右箭头的“Run Cell”按钮。</p>
<img class="img-responsive center-block" src="../img/python-notebook.png" alt="deeplearning4j"><br>
<p>然后系统会开始显示结果和日志，如下图所示。</p>
<img class="img-responsive center-block" src="../img/python-notebook-results.png" alt="deeplearning4j"><br>
<p>结果可能会显示为“loading Theano”，而我们实际上是在“劫持”Keras方法，让它们通过Py4J在JVM上运行。 </p>
<p>神经网络进行本地定型时，您有可能会用尽内存。如果发生这样的情况，请进入计算机界面的菜单栏，点击Docker的鲸鱼图标，然后选择Preferences/Advanced。您可以在此增加分配给Docker的内存。如果有足够的内存，我们建议分配8GB。 </p>
<img class="img-responsive center-block" src="../img/docker-provisioning.jpg" alt="deeplearning4j"><br>
<p>如果调整了分配给Docker的内存量，就需要点击右下方的按钮来重启Docker。</p><br>

<p><h2>视频：导入Keras模型</h2></p>
<div style="position: relative; padding-bottom: 56.25%; padding-top: 35px; width: 100%; height: 0; overflow: hidden;"><iframe frameborder="0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://v.qq.com/iframe/player.html?vid=l0366tap001&tiny=0&auto=0" allowfullscreen width="510px" height="498px"></iframe></div>

<br>
<p>本教程的代码可以在<a href="https://gist.github.com/tomthetrainer/f6e073444286e5d97d976bd77292a064">Github</a>上找到。用Theano或TensorFlow等其他后端定型模型的团队可以将其模型导入JVM而不损失任何工作成果。 </p>
<p>这一点很重要，因为不同的学习框架擅长解决不同的问题，而深度学习工作流的各个阶段也都由不同的编程语言所主导。Python虽然主导了数据探索和原型开发阶段，却并不一定最适合生产部署。Deeplearning4j与Hadoop、Spark、Kafka、ElasticSearch、Hive和Pig等大数据技术栈中常见的开源库高度集成。 </p>
<p>Deeplearning4j也获得了两种Hadoop生态系统发行版——Cloudera CDH和Hortonworks HDP的认证。导入Keras模型的功能让Deeplearning4j可以帮助深度学习用户将自己的神经网络模型转移到大型企业生产栈中运行。 </p>
<p>目前我们还不能支持Keras和其他深度学习框架支持的所有网络架构，但我们正在不断增加可以从Keras导入到DL4J的网络类型。 </p>
<p>Scala提供与Python相似的接口，对Scala感兴趣的Python程序员不妨了解一下<a href="https://github.com/deeplearning4j/scalnet" target="_blank">Deeplearning4j的Scala API——ScalNet</a>。 </p>
<p>更多关于从Keras导入模型的信息请参阅<a href="model-import-keras" target="_blank">模型导入指南</a>。</p>